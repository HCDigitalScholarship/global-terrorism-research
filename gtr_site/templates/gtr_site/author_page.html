{% extends "gtr_site/base.html" %}
{% include "gtr_site/nav_bar.html" %}
{% block title %}GTR{% endblock %}
{% block content %}
<div class= "row">
  <h2 id="page_title"> {{request.GET.a}}</h2> 
</div>
<br>
<div class= "row">
 <div class= "col-md-1">
 </div>
  <div class="col-md-10 table-responsive">
     <table class="table table-striped table-bordered" id="auth_state">
	<thead>
          <tr>
	    <th colspan="2">All statements statements associated with author: {{request.GET.a}}</th>
          </tr>
	</thead>
	<tbody>
     	  {% for result in results %}
	     {% ifequal result.author.person_name request.GET.a  %}
	 	 <tr>
		   <td>{{result.title}}</td>
		   <td ><a href="{{result.full_text }}">open</a></td>
		 </tr>
	     {% endifequal %}
    	 {% endfor %}
	</tbody>
     </table>
  </div>
  <div class="col-md-1">
  </div>
</div>
<div id="article"></div>
<script>

$(document).ready(function(){
	//console.log("READY!")
	var author_name = $('#page_title').text();
	//console.log(author_name);
 $.ajax({
       
                url: "https://en.wikipedia.org/w/api.php?page=author_name",
        data: {
            format: "json",
            action: "parse",
            //page: window.location.href,
            page: author_name,
	    prop: "text",
            section: 0,
        },
        dataType: 'jsonp',
        headers: {
            'Api-User-Agent': 'MyCoolTool/1.1 (http://example.com/MyCoolTool/; MyCoolTool@example.com) BasedOnSuperLib/1.4'
        },
        success: function (data) {

	   // console.log(data)
	   // console.log("OOO")

            var markup = data.parse.text["*"];
            var i = $('<div></div>').html(markup);
            $('#article').html(i);
            // remove links as they will not work

            i.find('a').each(function () {
                $(this).replaceWith($(this).html());
            });

            // remove any references
            i.find('sup').remove();

            // remove cite error
            i.find('.mw-ext-cite-error').remove();

            $('#article').html($(i).find('p'));

        }
    })

});
</script>

{% endblock %}
